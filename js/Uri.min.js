/*
 * jsUri
 * https://github.com/derek-watson/jsUri
 *
 * Copyright 2013, Derek Watson
 * Released under the MIT license.
 *
 * Includes parseUri regular expressions
 * http://blog.stevenlevithan.com/archives/parseuri
 * Copyright 2007, Steven Levithan
 * Released under the MIT license.
 */
(function(e){var d={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};if(!Array.prototype.forEach){Array.prototype.forEach=function(k,j){for(var h=0,g=this.length;h<g;++h){k.call(j||this,this[h],h,this)}}}function f(g){if(g){g=decodeURIComponent(g);g=g.replace(d.pluses," ")}return g}function c(j){var k=d.uri_parser;var h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];var g=k.exec(j||"");var i={};h.forEach(function(m,l){i[m]=g[l]||""});return i}function a(q){var j,o,m,r,h,g;var l=[];if(typeof(q)==="undefined"||q===null||q===""){return l}if(q.indexOf("?")===0){q=q.substring(1)}o=q.toString().split(d.query_separator);for(j=0;j<o.length;j++){m=o[j];r=m.indexOf("=");if(r!==0){h=decodeURIComponent(m.substring(0,r));g=decodeURIComponent(m.substring(r+1));l.push(r===-1?[m,null]:[h,g])}}return l}function b(g){this.uriParts=c(g);this.queryPairs=a(this.uriParts.query);this.hasAuthorityPrefixUserPref=null}["protocol","userInfo","host","port","path","anchor"].forEach(function(g){b.prototype[g]=function(h){if(typeof h!=="undefined"){this.uriParts[g]=h}return this.uriParts[g]}});b.prototype.hasAuthorityPrefix=function(g){if(typeof g!=="undefined"){this.hasAuthorityPrefixUserPref=g}if(this.hasAuthorityPrefixUserPref===null){return(this.uriParts.source.indexOf("//")!==-1)}else{return this.hasAuthorityPrefixUserPref}};b.prototype.query=function(k){var h="",g,j;if(typeof k!=="undefined"){this.queryPairs=a(k)}for(g=0;g<this.queryPairs.length;g++){j=this.queryPairs[g];if(h.length>0){h+="&"}if(j[1]===null){h+=j[0]}else{h+=j[0];h+="=";if(j[1]){h+=encodeURIComponent(j[1])}}}return h.length>0?"?"+h:h};b.prototype.getQueryParamValue=function(h){var j,g;for(g=0;g<this.queryPairs.length;g++){j=this.queryPairs[g];if(h===j[0]){return j[1]}}};b.prototype.getQueryParamValues=function(j){var g=[],h,k;for(h=0;h<this.queryPairs.length;h++){k=this.queryPairs[h];if(j===k[0]){g.push(k[1])}}return g};b.prototype.deleteQueryParam=function(k,n){var g=[],j,m,h,l;for(j=0;j<this.queryPairs.length;j++){m=this.queryPairs[j];h=f(m[0])===f(k);l=m[1]===n;if((arguments.length===1&&!h)||(arguments.length===2&&(!h||!l))){g.push(m)}}this.queryPairs=g;return this};b.prototype.addQueryParam=function(h,i,g){if(arguments.length===3&&g!==-1){g=Math.min(g,this.queryPairs.length);this.queryPairs.splice(g,0,[h,i])}else{if(arguments.length>0){this.queryPairs.push([h,i])}}return this};b.prototype.replaceQueryParam=function(l,j,g){var h=-1,k,m;if(arguments.length===3){for(k=0;k<this.queryPairs.length;k++){m=this.queryPairs[k];if(f(m[0])===f(l)&&decodeURIComponent(m[1])===f(g)){h=k;break}}this.deleteQueryParam(l,g).addQueryParam(l,j,h)}else{for(k=0;k<this.queryPairs.length;k++){m=this.queryPairs[k];if(f(m[0])===f(l)){h=k;break}}this.deleteQueryParam(l);this.addQueryParam(l,j,h)}return this};["protocol","hasAuthorityPrefix","userInfo","host","port","path","query","anchor"].forEach(function(g){var h="set"+g.charAt(0).toUpperCase()+g.slice(1);b.prototype[h]=function(i){this[g](i);return this}});b.prototype.scheme=function(){var g="";if(this.protocol()){g+=this.protocol();if(this.protocol().indexOf(":")!==this.protocol().length-1){g+=":"}g+="//"}else{if(this.hasAuthorityPrefix()&&this.host()){g+="//"}}return g};b.prototype.origin=function(){var g=this.scheme();if(g=="file://"){return g+this.uriParts.authority}if(this.userInfo()&&this.host()){g+=this.userInfo();if(this.userInfo().indexOf("@")!==this.userInfo().length-1){g+="@"}}if(this.host()){g+=this.host();if(this.port()){g+=":"+this.port()}}return g};b.prototype.addTrailingSlash=function(){var g=this.path()||"";if(g.substr(-1)!=="/"){this.path(g+"/")}return this};b.prototype.toString=function(){var h,g=this.origin();if(this.path()){h=this.path();if(!(d.ends_with_slashes.test(g)||d.starts_with_slashes.test(h))){g+="/"}else{if(g){g.replace(d.ends_with_slashes,"/")}h=h.replace(d.starts_with_slashes,"/")}g+=h}else{if(this.host()&&(this.query().toString()||this.anchor())){g+="/"}}if(this.query().toString()){if(this.query().toString().indexOf("?")!==0){g+="?"}g+=this.query().toString()}if(this.anchor()){if(this.anchor().indexOf("#")!==0){g+="#"}g+=this.anchor()}return g};b.prototype.clone=function(){return new b(this.toString())};if(typeof define==="function"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=b}else{e.Uri=b}}})(this.window||global);
